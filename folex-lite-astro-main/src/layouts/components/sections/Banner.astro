---
import type { z } from "astro/zod";
import type { Section } from "@/types";
import { getEntryCTM } from "@/lib/contentParser.astro";
import { markdownify } from "@/lib/utils/textConverter";
import CustomButton from "@/components/CustomButton.astro";
import overrideObjects from "@/lib/utils/overrideObjects.ts";
import type { bannerAgencySectionSchema } from "@/sections.schema";
import OptimizedImage from "@/components/utilities/OptimizedImage.astro";

// Type for this section data
type bannerAgency = Section &
  NonNullable<z.infer<typeof bannerAgencySectionSchema>>;

type Props = {
  content?: bannerAgency;
};

// Fetching the default content for the this section
let defaultContent = (
  await getEntryCTM("sections", "banner", Astro.currentLocale)
)?.data as bannerAgency;

// Enables content customization (e.g., title, description) with a fallback to 'defaultContent' if not provided.
// The 'content' prop should match the structure of 'defaultContent'.
// Allows using this section with different content across multiple pages.
// If 'content' is missing, 'defaultContent' will be used.
let actualContent = overrideObjects(
  { ...defaultContent },
  Astro.props.content,
) as bannerAgency;

// Extracting required values from 'content' object
let { title, image, titleSize, description, button } =
  actualContent as bannerAgency;

// Font sizes for the heading (useful if you have a long heading)
const fontSizeMap: Record<NonNullable<typeof titleSize>, string> = {
  "display-1": "text-display-3 lg:text-display-2 xl:text-display-1",
  "display-2": "text-display-5 md:text-display-3 xl:text-display-2",
  "display-3": "text-display-5 md:text-display-4 xl:text-display-3",
};

const fontSize = titleSize ? fontSizeMap[titleSize] : fontSizeMap["display-1"];
---

<section class="text-light mb-24 bg-black pt-52 md:mb-32">
  <div class="container">
    <div class="mx-auto max-w-7xl space-y-7 text-center md:space-y-10">
      {
        title && (
          <h1
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            class:list={[
              "text-inherit",
              fontSize,
              "block leading-tight font-bold wrap-break-word text-inherit",
            ]}
            set:html={markdownify(title)}
          />
        )
      }
      {
        button?.enable ? (
          <div
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            data-aos-delay="200"
            class="mx-auto max-w-2xl space-y-6">
            {description && (
              <p
                class="text-lg text-inherit opacity-80"
                set:html={markdownify(description)}
              />
            )}
            {button && button.enable && (
              <CustomButton
                hoverEffect="creative-fill"
                class="btn-accent effect-color-dark mx-auto"
                {...button}
              />
            )}
          </div>
        ) : (
          description && (
            <p
              data-aos="reveal-anim-top"
              data-aos-delay="200"
              data-aos-duration="1500"
              class="mx-auto max-w-2xl text-lg text-inherit opacity-80"
              set:html={markdownify(description)}
            />
          )
        )
      }

      {
        image && (
          <div
            data-aos="reveal-anim-top"
            data-aos-duration="1500"
            data-aos-delay="300"
            data-aos-offset="0"
            class="mx-auto mt-10 -mb-24 max-w-4xl md:mt-20 md:-mb-32">
            <OptimizedImage
              src={image}
              alt={title || "Banner"}
              class="h-110 w-full object-cover md:h-135"
            />
          </div>
        )
      }
    </div>
  </div>
</section>

<style>
  /* Color sweep animation for PYME: appears white, then red fills from left to right */
  :global(.pyme-word) {
    display: inline-block;
    background: linear-gradient(to right, #e53e3e 50%, white 50%);
    background-size: 200% 100%;
    background-position: 100% 0;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: pyme-color-sweep 0.8s cubic-bezier(0.4, 0, 0.2, 1) 1.6s forwards;
  }

  @keyframes pyme-color-sweep {
    to {
      background-position: 0% 0;
    }
  }

  /* "vender m√°s" and services: heavy smash animation without colors */
  :global(.vender-word),
  :global(.service-word) {
    display: inline-block;
    opacity: 0; /* Starts hidden until animation triggers */
    color: white; /* Ensure it stands out cleanly */
    font-weight: 900;
    transform-origin: bottom center;
  }

  :global(.service-web) {
    animation: hulk-smash 0.7s linear forwards;
    animation-delay: 2.0s;
  }

  :global(.service-ecommerce) {
    animation: hulk-smash 0.7s linear forwards;
    animation-delay: 2.7s;
  }

  :global(.service-landing) {
    animation: hulk-smash 0.7s linear forwards;
    animation-delay: 3.4s;
  }

  :global(.vender-word) {
    animation: hulk-smash 0.8s linear forwards;
    animation-delay: 4.2s;
  }

  @keyframes hulk-smash {
    0% {
      opacity: 0;
      transform: scale(3.5) translateY(-100px); /* Massive and high */
      text-shadow: 0 0 0 rgba(255, 255, 255, 0);
    }
    30% {
      /* Fast drop, accelerating */
      opacity: 1;
      transform: scale(1.5) translateY(-20px);
    }
    35% {
      /* Direct hard hit - NO SQUASHING, just stops instantly */
      transform: scale(1) translateY(0);
      text-shadow: 0 0 60px rgba(255, 255, 255, 1);
    }
    40% {
      /* Violent screen shake (moves left and down) */
      transform: scale(1) translateX(-8px) translateY(4px) rotate(-3deg);
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.8);
    }
    45% {
      /* Violent screen shake (moves right and up) */
      transform: scale(1) translateX(8px) translateY(-4px) rotate(3deg);
    }
    50% {
      /* Medium shake */
      transform: scale(1) translateX(-5px) translateY(2px) rotate(-1deg);
    }
    55% {
      /* Medium shake */
      transform: scale(1) translateX(5px) translateY(-2px) rotate(1deg);
    }
    60% {
      /* Small shake */
      transform: scale(1) translateX(-2px) translateY(1px);
    }
    65% {
      /* Settles completely rigid */
      transform: scale(1) translateX(0) translateY(0) rotate(0);
      text-shadow: 0 0 0 rgba(255, 255, 255, 0);
    }
    100% {
      opacity: 1;
      transform: scale(1) translateX(0) translateY(0);
    }
  }
</style>
